# 注册申请机器人

[QQ 开放平台](http://q.qq.com) 获得必要接入信息，AppId，AppSecret，Token

# 用户端功能简介

## 基础消息对话

### 对话场景

  ------------------------------------------------------------ ------------------------------------------------------------ ------------------------------------------------------------ ------------------------------------------------------------
  单聊                                                         群聊                                                         文字子频道                                                   频道私信

  ![descript](media/image1.png){width="1.4020833333333333in"   ![descript](media/image2.png){width="1.4020833333333333in"   ![descript](media/image3.png){width="1.4020833333333333in"   ![descript](media/image4.png){width="1.4020833333333333in"
  height="3.0344608486439193in"}                               height="3.0344608486439193in"}                               height="3.0344608486439193in"}                               height="3.0344608486439193in"}
  ------------------------------------------------------------ ------------------------------------------------------------ ------------------------------------------------------------ ------------------------------------------------------------

### 消息类型

### 指令面板

  ------------------------------------------------------------ ------------------------------------------------------------ ----------------- -----------------
  /                                                            @                                                            ～                ～

  ![descript](media/image5.png){width="1.4118055555555555in"   ![descript](media/image6.png){width="1.4118055555555555in"   ～                ～
  height="3.055501968503937in"}                                height="3.055501968503937in"}                                                  
  ------------------------------------------------------------ ------------------------------------------------------------ ----------------- -----------------

### 自定义菜单

  ------------------------------------------------------------ ----------------- ----------------- -----------------
  单聊                                                         ～                ～                ～

  ![descript](media/image7.png){width="1.4020833333333333in"   ～                ～                ～
  height="3.0344608486439193in"}                                                                   
  ------------------------------------------------------------ ----------------- ----------------- -----------------

### 消息交互

  ------------------------------------------------------------ ------------------------------------------------------------ ----------------- -----------------
  消息按钮                                                     文字链                                                       ～                ～

  ![descript](media/image8.png){width="1.4118055555555555in"   ![descript](media/image9.png){width="1.4118055555555555in"   ～                ～
  height="3.055501968503937in"}                                height="3.055501968503937in"}                                                  
  ------------------------------------------------------------ ------------------------------------------------------------ ----------------- -----------------

## 资料卡与设置

## 分享推荐与搜索

  ----------------- ----------------- ----------------- -----------------
  分享机器人        群管理推荐位      频道管理推荐位    群聊加号面板

  支持              支持              支持              暂未支持
  ----------------- ----------------- ----------------- -----------------

  ----------------- ----------------- ----------------- -----------------
  机器人QQ号搜索    昵称搜索          机器人分类搜索    \~

  支持              暂未支持          暂未支持          \~
  ----------------- ----------------- ----------------- -----------------

# 接入开发准备

## 接口通信框架

接口通信基础框架

![图标 描述已自动生成](media/image10.png){width="6.458437226596676in"
height="2.854212598425197in"}

### 

### API 调用｜鉴权

#### 获取接口凭证

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       https://bots.qq.com/app/getAppAccessToken

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **请求参数**

  -------------- ----------- --------- -------------------------------------
  属性           类型        必填      说明

  appId          string      是        在开放平台管理端上获得。

  clientSecret   string      是        在开放平台管理端上获得。
  -------------- ----------- --------- -------------------------------------

-   **返回参数**

  -------------- --------- ------------------------------------------------
  属性           类型      说明

  access_token   string    获取到的凭证。

  expires_in     number    凭证有效时间，单位：秒。目前是7200秒之内的值。
  -------------- --------- ------------------------------------------------

-   **错误码**

  ---------- ----------------------- ------------------------------------
  错误码     错误码取值              解决方案

  0          ok                      
  ---------- ----------------------- ------------------------------------

-   **调用示例**

```{=html}
<!-- -->
```
-   **返回示例**

-   **其他说明**

目前 access_token 生命周期默认 7200 秒，每次请求不会刷新新的
access_token，开发者需要在过期后自行刷新
access_token，保证调用链路权限正常。

在上一个 access_token 接近过期时间 60 秒内，获取 access_token
时，会获得一个新的 access_token，老的 access_token
在这个60秒内仍然有效。

#### 接口调用

在每次调用 https 的 openapi 开放接口请求的时候，需要在 header 内引入
access_token 进行调用权限验证。

**统一地址**

**请求头**

  --------------- -------- -------- --------------------------------------
  名称            类型     必填     描述

  Authorization   string   是       格式值：\"QQBot ACCESS_TOKEN\"

  X-Union-Appid   string   是       格式值：\"BOT_APPID\", 机器人 appid
  --------------- -------- -------- --------------------------------------

**事例**

#### 调用权限错误码

与 access token 权限有关的错误码。

### 事件订阅｜异步通知

#### 

#### WebSocket 方式

通过 WebSocket
建立与QQ后台的长链接通信管道，当需要事件通知的时候QQ后台通过 WebSocket
连接下发事件到开发者服务器上。

开发者需要维护 WebSocket
长链接的状态，包括连接状态维护、登录鉴权、心跳维护、断线恢复重连等。

优势：本地服务器即可发起调试，无需依赖公网域名和公网服务器（WebHook）接收回调通知。

##### 通用数据结构 Payload

payload 指的是在 websocket
连接上传输的数据，网关的上下行消息采用的都是同一个结构，如下：

##### 长连接维护 OpCode

所有 opcode 列表如下：

  ------- ------------------ --------------- ------------------------------------------------
  CODE    名称               客户端行为      描述

  0       Dispatch           Receive         服务端进行消息推送

  1       Heartbeat          Send/Receive    客户端或服务端发送心跳

  2       Identify           Send            客户端发送鉴权

  6       Resume             Send            客户端恢复连接

  7       Reconnect          Receive         服务端通知客户端重新连接

  9       Invalid Session    Receive         当 identify 或 resume
                                             的时候，如果参数有错，服务端会返回该消息

  10      Hello              Receive         当客户端与网关建立 ws
                                             连接之后，网关下发的第一条消息

  11      Heartbeat ACK      Receive/Reply   当发送心跳成功之后，就会收到该消息

  12      HTTP Callback ACK  Reply           仅用于 http
                                             回调模式的回包，代表机器人收到了平台推送的数据
  ------- ------------------ --------------- ------------------------------------------------

客户端行为含义如下：

Receive 客户端接收到服务端 push 的消息

Send 客户端发送消息

Reply 客户端接收到服务端发送的消息之后的回包（HTTP 回调模式）

##### 发起连接到 Gateway 

第一步先调用 [获取通用 WSS 接入点 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/wss/url_get.html)
或 [获取带分片 WSS 接入点 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/wss/shard_url_get.html)
接口获取网关地址。

会得到一个类似下面这样的地址：

然后进行 websocket 长连接建立，一旦连接成功，就会返回 OpCode 10 Hello
消息。这个消息主要的内容是心跳周期，单位毫秒(milliseconds)，如下：

##### 登录鉴权获得 Session

websocket 长连接建立之后，需要进行登录鉴权，登录鉴权成功后会获得一个
session 会话 id，只有登录成功后，QQ后台才会下发事件通知，

发送一个 OpCode 2 Identify 消息，payload 如下：

+-------------+--------------------------------------------------------+
| 字段        | 描述                                                   |
+-------------+--------------------------------------------------------+
| token       | 格式为\"QQBot {AccessToken}\"                          |
+-------------+--------------------------------------------------------+
| intents     | 是此次连接所需要接收的事件，具体可参考 Intents         |
|             | [事件订阅 intents \|                                   |
|             | QQ机器人文档](https                                    |
|             | ://bot.q.qq.com/wiki/develop/api/gateway/intents.html) |
+-------------+--------------------------------------------------------+
| shard       | 考虑到开发者事件接收时可以实现负载均衡，               |
|             |                                                        |
|             | QQ 提供了分片逻辑，事件通知会落在不同的分片上，        |
|             |                                                        |
|             | 该参数是个拥有两个元素的数组。                         |
|             |                                                        |
|             | 例如：\[0,4\]，代表分为四个片，当前链接是第 0 个片，   |
|             |                                                        |
|             | 业务稍后应该继续建立 shard                             |
|             | 为\[1,4\],\[2,4\],\[3,4\]的链接，                      |
|             |                                                        |
|             | 才能完整接收事件，更多详细的内容可以参考 Shard [Shard  |
|             | 机制 \|                                                |
|             | QQ机器人文档](htt                                      |
|             | ps://bot.q.qq.com/wiki/develop/api/gateway/shard.html) |
|             |                                                        |
|             | 若无需分片，使用\[0, 1\]即可。                         |
+-------------+--------------------------------------------------------+
| properties  | 目前无实际作用，可以按照自己的实际情况填写，也可以留空 |
+-------------+--------------------------------------------------------+

鉴权成功之后，QQ 后台会下发一个 Ready Event，payload 如下：

##### 发送心跳 Ack

鉴权成功之后，就需要按照周期进行心跳发送。d 为客户端收到的最新的消息的
s，如果是首次连接，d 为传 null，payload 如下：

心跳发送成功之后会收到 OpCode 11 Heartbeat ACK 消息，payload 如下：

##### 恢复登录态 Session 

有很多原因可能会导致 websocket
长连接断开，断开之后短时间内重连会补发中间遗漏的事件，以保障业务逻辑的正确性。断开重连
gateway 后不需要发送重新登录 Opcode 2 Identify 请求。在连接到 Gateway
之后，需要发送 Opcode 6 Resume消息，payload 如下：

其中 seq 指的是在接收事件时候的 s
字段，我们推荐开发者在处理过事件之后记录下 s 这样可以在 resume
的时候传递给 websocket，websocket 会自动补发这个 seq 之后的事件。

恢复成功之后，就开始补发遗漏事件，

所有事件补发完成之后，会下发一个 Resumed Event，payload 如下：

##### 

##### 事件类型 Intents

详细文档：[事件订阅 intents \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/intents.html)

##### 

##### 分片连接 LoadBalance

详细文档：[Shard 机制 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/shard.html)

#### 🚫WebHook 方式

\[暂不对外开放\]

在管理端配置的对应订阅事件的 webhook 地址，所有的事件会通过 http
的方式异步回调给开发者，开发者收到后需要回应 200 Ok，若 QQ
后台没收到正确的响应，会在合理时机重试发送。

## 唯一身份机制

不同的 bot（AppId） 获取到的用户 openid，群 openid，频道 openid
均不一样，若跨业务有串联身份需求，后续提供跨 AppId 绑定后，使用 unionid
打通身份。

举个例子：

# 服务端接口 

## 消息相关

消息模块是机器人能力最核心的部分，支持机器人在QQ各个场景下的消息收发操作，也是机器人与用户交互最常见的场景。

### 消息收发

#### ✅发送消息

##### ✅单聊

单独发动消息给用户。

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /v2/users/{openid}/messages

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  ------------- ---------- ---------- --------------------------------------------
  属性          **类型**   **必填**   **说明**

  openid        string     是         QQ 用户的 openid，可在各类事件中获得。
  ------------- ---------- ---------- --------------------------------------------

-   **请求参数**

+-----------+------+----+--------------------------------------------+
| **属性**  | **类 | ** | **说明**                                   |
|           | 型** | 必 |                                            |
|           |      | 填 |                                            |
|           |      | ** |                                            |
+-----------+------+----+--------------------------------------------+
| content   | st   | 否 | 文本内容                                   |
|           | ring |    |                                            |
+-----------+------+----+--------------------------------------------+
| msg_type  | int  | 是 | 消息类型：0 是文本，1 图文混排 ，2 是      |
|           |      |    | markdown                                   |
|           |      |    |                                            |
|           |      |    | 3 ark，4 embed                             |
|           |      |    |                                            |
|           |      |    | 备注：当发送 markdown，ark，embed 的时候   |
|           |      |    | content                                    |
|           |      |    | 字段需要填入随意                           |
|           |      |    | 内容，否则发送失败（后续版本解决该问题）。 |
+-----------+------+----+--------------------------------------------+
| markdown  | ob   | 否 | 格式                                       |
|           | ject |    | 参考"消息类型=\>markdown=\>数据结构与协议" |
+-----------+------+----+--------------------------------------------+
| keyboard  | ob   | 否 | 格                                         |
|           | ject |    | 式参考"消息交互=\>消息按钮=\>数据结构与协" |
+-----------+------+----+--------------------------------------------+
| ark       | ob   | 否 | 格式参考"消息类型=\>ark=\>数据结构与协议"  |
|           | ject |    |                                            |
+-----------+------+----+--------------------------------------------+
| image     |      | 否 | 【暂不支持】                               |
+-----------+------+----+--------------------------------------------+
| message_  | ob   | 否 | 【暂未支持】消息引用                       |
| reference | ject |    |                                            |
+-----------+------+----+--------------------------------------------+
| event_id  | st   | 否 | 【暂                                       |
|           | ring |    | 未支持】前置收到的事件ID，用于发送被动消息 |
+-----------+------+----+--------------------------------------------+
| msg_id    | st   | 否 | 前置收到的消息ID，用于发送被动消息         |
|           | ring |    |                                            |
+-----------+------+----+--------------------------------------------+

-   **返回参数**

  ------------- ---------- ------------------------------------------------
  **属性**      **类型**   **说明**

  id            string     消息唯一ID

  timestamp     int        发送时间
  ------------- ---------- ------------------------------------------------

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

##### ✅群聊

发动消息到群。

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /v2/groups/{group_openid}/messages

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  -------------- ---------- ---------- --------------------------------------------
  属性           **类型**   **必填**   **说明**

  group_openid   string     是         群聊的 openid
  -------------- ---------- ---------- --------------------------------------------

-   **请求参数**

+-----------+------+----+--------------------------------------------+
| **属性**  | **类 | ** | **说明**                                   |
|           | 型** | 必 |                                            |
|           |      | 填 |                                            |
|           |      | ** |                                            |
+-----------+------+----+--------------------------------------------+
| content   | st   | 是 | 文本内容                                   |
|           | ring |    |                                            |
+-----------+------+----+--------------------------------------------+
| msg_type  | int  | 是 | 消息类型： 0 是文本，1 图文混排 ，2 是     |
|           |      |    | markdown                                   |
|           |      |    |                                            |
|           |      |    | 3 ark，4 embed，5 at \@人或@all            |
|           |      |    |                                            |
|           |      |    | 备注：当发送 md，ark                       |
|           |      |    | 的时候content需要填入随意                  |
|           |      |    | 内容，否则发送失败（后续版本解决该问题）。 |
+-----------+------+----+--------------------------------------------+
| markdown  | ob   | 否 | 格式                                       |
|           | ject |    | 参考"消息类型=\>markdown=\>数据结构与协议" |
+-----------+------+----+--------------------------------------------+
| keyboard  | ob   | 否 | 格                                         |
|           | ject |    | 式参考"消息交互=\>消息按钮=\>数据结构与协" |
+-----------+------+----+--------------------------------------------+
| ark       | ob   | 否 | 格式参考"消息类型=\>ark=\>数据结构与协议"  |
|           | ject |    |                                            |
+-----------+------+----+--------------------------------------------+
| image     |      | 否 | 【暂不支持】                               |
+-----------+------+----+--------------------------------------------+
| message_  | ob   | 否 | 【暂未支持】消息引用                       |
| reference | ject |    |                                            |
+-----------+------+----+--------------------------------------------+
| event_id  | st   | 否 | 【暂                                       |
|           | ring |    | 未支持】前置收到的事件ID，用于发送被动消息 |
+-----------+------+----+--------------------------------------------+
| msg_id    | st   | 否 | 前置收到的消息ID，用于发送被动消息         |
|           | ring |    |                                            |
+-----------+------+----+--------------------------------------------+
| timestamp | int  | 是 | unix 秒级时间戳                            |
+-----------+------+----+--------------------------------------------+

-   **返回参数**

  ------------ ---------- --------------------------------------------------
  **属性**     **类型**   **说明**

  id           string     消息唯一 ID

  timestamp    int        发送时间
  ------------ ---------- --------------------------------------------------

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

##### 

##### ✅文字子频道

发动消息到文字子频道。

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /channels/{channel_id}/messages

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **详细文档**

[发送消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/message/post_messages.html)

##### ✅频道私信

发动消息到频道私信，请求参数与文字子频道发送消息参数一致

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /dms/{guild_id}/messages

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **详细文档**

[发送私信 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/dms/post_dms_messages.html)

#### ✅富媒体消息

仅用于在QQ单聊和QQ群聊内，发送图片、视频、语音、文件的相关富媒体资源在消息收发的候使用。

##### ✅发送到单聊

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /v2/users/{openid}/files

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  ------------- ---------- ---------- --------------------------------------------
  属性          **类型**   **必填**   **说明**

  openid        string     是         QQ 用户的 openid，可在各类事件中获得。
  ------------- ---------- ---------- --------------------------------------------

-   **请求参数**

+------------+-----+----+--------------------------------------------+
| **属性**   | *   | ** | **说明**                                   |
|            | *类 | 必 |                                            |
|            | 型  | 填 |                                            |
|            | **  | ** |                                            |
+------------+-----+----+--------------------------------------------+
| file_type  | int | 是 | 媒体类型：                                 |
|            |     |    |                                            |
|            |     |    | 1 图片，2 视频，3 语音，4 文件（暂不开放） |
|            |     |    |                                            |
|            |     |    | 资源格式要求                               |
|            |     |    |                                            |
|            |     |    | 图片：png/jpg，视频：mp4，语音：slik       |
+------------+-----+----+--------------------------------------------+
| url        | str | 是 | 需要发送媒体资源的url                      |
|            | ing |    |                                            |
+------------+-----+----+--------------------------------------------+
| sr         | b   | 是 | 固定是：true                               |
| v_send_msg | ool |    |                                            |
+------------+-----+----+--------------------------------------------+
| file_data  |     | 否 | 【暂未支持】                               |
+------------+-----+----+--------------------------------------------+

-   **返回参数**

  ------------- ---------- ------------------------------------------------
  **属性**      **类型**   **说明**

  id            string     消息唯一ID

  timestamp     int        发送时间
  ------------- ---------- ------------------------------------------------

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

##### ✅发送到群聊

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /v2/groups/{group_openid}/files

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  -------------- ---------- ---------- --------------------------------------------
  属性           **类型**   **必填**   **说明**

  group_openid   string     是         群聊的 openid
  -------------- ---------- ---------- --------------------------------------------

-   **请求参数**

+------------+-----+----+--------------------------------------------+
| **属性**   | *   | ** | **说明**                                   |
|            | *类 | 必 |                                            |
|            | 型  | 填 |                                            |
|            | **  | ** |                                            |
+------------+-----+----+--------------------------------------------+
| file_type  | int | 是 | 媒体类型：                                 |
|            |     |    |                                            |
|            |     |    | 1 图片，2 视频，3 语音，4 文件（暂不开放） |
|            |     |    |                                            |
|            |     |    | 资源格式要求                               |
|            |     |    |                                            |
|            |     |    | 图片：png/jpg，视频：mp4，语音：slik       |
+------------+-----+----+--------------------------------------------+
| url        | str | 是 | 需要发送媒体资源的url                      |
|            | ing |    |                                            |
+------------+-----+----+--------------------------------------------+
| sr         | b   | 是 | 固定是：true                               |
| v_send_msg | ool |    |                                            |
+------------+-----+----+--------------------------------------------+
| file_data  |     | 否 | 【暂未支持】                               |
+------------+-----+----+--------------------------------------------+

-   **返回参数**

  ------------- ---------- ------------------------------------------------
  **属性**      **类型**   **说明**

  id            string     消息唯一ID

  timestamp     int        发送时间
  ------------- ---------- ------------------------------------------------

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

#### ✅修改消息

##### 🚫文字子频道

\[暂不对外开放\]

##### 🚫频道私信

\[暂不对外开放\]

#### ✅撤回消息

##### 🚫单聊

\[暂不对外开放\]

##### 🚫群聊

\[暂不对外开放\]，管理员身份可撤回的加多消息

##### 

##### ✅文字子频道

-   **详细文档**

[撤回消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/message/delete_message.html)

##### ✅频道私信

-   **详细文档**

[撤回私信 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/dms/delete_dms.html)

#### 🚫批量发消息

#### ✅事件(8)

##### ✅单聊消息

用户在单聊发送消息给机器人

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1\<\<25

  事件类型      C2C_MESSAGE_CREATE

  触发场景      用户在单聊发送消息给机器人

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

+-----------+-----------+----------------------------------------------+
| 属性      | 类型      | 说明                                         |
+-----------+-----------+----------------------------------------------+
| id        | string    | 平台方消息ID，可以用于被动消息发送           |
+-----------+-----------+----------------------------------------------+
| author    | object    | 发送者                                       |
|           |           |                                              |
|           |           | \"id\": \"xxx\" // 用户openid                |
+-----------+-----------+----------------------------------------------+
| content   | string    | 文本消息内容                                 |
+-----------+-----------+----------------------------------------------+
| timestamp | string    | 消息生产时间                                 |
+-----------+-----------+----------------------------------------------+
| at        | o         | 富媒体                                       |
| tachments | bject\[\] | 文件附件，文件类型："图片，语音，视频，文件" |
|           |           |                                              |
|           |           | {\"content_type\": \"\", \"filename\": \"\", |
|           |           | \"height\": \"\", \"width\": \"\", \"size\": |
|           |           | \"\", \"url\": \"\"}                         |
+-----------+-----------+----------------------------------------------+
|           |           |                                              |
+-----------+-----------+----------------------------------------------+

-   **事件示例**

```{=html}
<!-- -->
```
-   **其他说明**

暂无

##### ✅群聊@机器人

用户在群内@机器人发动的消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1\<\<25

  事件类型      GROUP_AT_MESSAGE_CREATE

  触发场景      用户在群聊@机器人发送消息

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

+-----------+----------+----------------------------------------------+
| 属性      | 类型     | 说明                                         |
+-----------+----------+----------------------------------------------+
| id        | string   | 平台方消息 ID，可以用于被动消息发送          |
+-----------+----------+----------------------------------------------+
| author    | object   | 发送者                                       |
+-----------+----------+----------------------------------------------+
| conent    | string   | 消息内容                                     |
+-----------+----------+----------------------------------------------+
| timestamp | string   | 消息生产时间                                 |
+-----------+----------+----------------------------------------------+
| group_id  | string   | 群聊的 openid                                |
+-----------+----------+----------------------------------------------+
| at        | ob       | 富媒体                                       |
| tachments | ject\[\] | 文件附件，文件类型："图片，语音，视频，文件" |
|           |          |                                              |
|           |          | {\"content_type\": \"\", \"filename\": \"\", |
|           |          | \"height\": \"\", \"width\": \"\", \"size\": |
|           |          | \"\", \"url\": \"\"}                         |
+-----------+----------+----------------------------------------------+

-   **事件示例**

```{=html}
<!-- -->
```
-   **其他说明**

暂无

#####  🚫群聊全量消息（私域）

「暂不开放」用户在群内发送的所有聊天消息

##### 🚫群聊关键词消息

「暂不开放」用户在群内发送的消息命中了某些关键词

##### ✅频道私信消息

用户在频道私信给机器人发送的消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  事件类型      DIRECT_MESSAGE_CREATE

  触发场景      用户在频道私信内发送消息给机器人

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **详细文档**

[私信消息事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/direct_message.html#direct-message-create-intents-direct-message)

##### ✅文字子频道@机器人

用户在文字子频道内@机器人发送的消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  事件类型      AT_MESSAGE_CREATE

  触发场景      用户在频道私信内发送消息给机器人

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **详细文档**

[消息事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/message.html)

##### ✅文字子频道全量消息（私域）

用户在文字子频道内发送的所有聊天消息（私域）

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  事件类型      MESSAGE_CREATE

  触发场景      用户在频道私信内发送消息给机器人

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **详细文档**

[消息事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/message.html)，字段结构与
AT_MESSAGE_CREATE 相同。

##### 

##### 🚫文字子频道关键词消息

「暂不开放」用户在文字子频道内发送的消息命中了某些关键词

### 消息类型(10)

#### ✅文本

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           支持           支持           支持

  机器人发送     支持           支持           支持           支持
  -------------- -------------- -------------- -------------- --------------

#### 

#### ⚠️图文

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           支持           支持           支持

  机器人发送     近期支持       近期支持       支持           支持
  -------------- -------------- -------------- -------------- --------------

#### 

#### ⚠️表情

内测中，近期支持

#### ✅图片

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           \-             \-             支持

  机器人发送     支持           支持           支持           支持
  -------------- -------------- -------------- -------------- --------------

#### 

#### ✅视频

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           \-             \-             支持

  机器人发送     支持           支持           支持           支持
  -------------- -------------- -------------- -------------- --------------

#### 

#### ✅语音

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           \-             \-             \-

  机器人发送     支持           支持           \-             \-
  -------------- -------------- -------------- -------------- --------------

#### 

#### ✅文件

目前接收文件仅支持，pdf、doc、txt 格式

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     支持           \-             \-             \-

  机器人发送     未开放         未开放         \-             \-
  -------------- -------------- -------------- -------------- --------------

#### ✅Embed

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收     \-             \-             \-             \-

  机器人发送     未开放         未开放         支持           支持
  -------------- -------------- -------------- -------------- --------------

##### 数据结构与协议

-   **详细文档**

[embed 消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/message/template/embed_message.html)

#### ✅ARK

部分 ARK 需要内邀开通

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收                                                  

  机器人发送     支持           支持           支持           支持
  -------------- -------------- -------------- -------------- --------------

##### 发送方式

选择合适的 ARK 模版发送，模版的有预设变量，变量类型可以是
字符串、数组、URL等。

##### 数据结构与协议

消息发送接口 ark 字段值是一个 json object，具体字段如下：

  ----------------- ---------- ----------- ----------------------------------
  **属性**          **类型**   **必填**    **说明**

  template_id       int        是          模版
                                           id，管理端可获得或内邀申请获得

  kv                array      是          {key: xxx, value:
                                           xxx}，模版内变量与填充值的kv映射
  ----------------- ---------- ----------- ----------------------------------

特别：当预设变量是数组时，kv数组元素的结构调整为：

#### ✅Markdown

目前需要内邀开通

  -------------- -------------- -------------- -------------- --------------
                 单聊           群聊           文字子频道     频道私信

  机器人接收                                                  

  机器人发送     支持           支持           支持           支持
  -------------- -------------- -------------- -------------- --------------

##### 支持格式

###### 标题

###### 文字样式

###### 链接

###### 图片

###### 有序列表

###### 无序列表

###### 列表嵌套

###### 块引用

###### 水平分割线

###### 换多行

##### 发送方式

自定义 markdown 消息：\[内邀使用\]

消息模版：QQ Bot 提供 markdown 消息模版能力。

##### 数据结构与协议

消息发送 markdown 字段值是一个 json object，具体字段如下：

  -------------------- ---------- ----------- ----------------------------------
  **属性**             **类型**   **必填**    **说明**

  content              string     否          原生 markdown 文本内容

  custom_template_id   string     否          markdown 模版id，申请模版后获得

  params               Array      否          {key: xxx, values:
                                              xxx}，模版内变量与填充值的kv映射
  -------------------- ---------- ----------- ----------------------------------

### 消息交互(3)

#### ✅表情表态

##### 机器人发表表情表态

-   **详细文档**

[发表表情表态 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/reaction/put_message_reaction.html)

##### 删除机器人发表的表情表态

-   **详细文档**

[删除自己的表情表态 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/reaction/delete_own_message_reaction.html)

##### 获取消息表情表态的用户列表

-   **详细文档**

[拉取表情表态用户列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/reaction/get_reaction_users.html)

##### 事件

###### 用户发表

-   **基本概况**

用户对消息进行表情表态时，触发事件通知。

-   **详细文档**

[表情表态事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild_message_reactions.html)

#### ✅文字链

##### AT 相关

群聊&文字子频道，支持 文本消息、图文消息、markdown消息。

at 某人，解析为 \@用户 标签

嵌入文本格式：

at 所有人，解析为 \@所有人 标签，需要机器人拥有发送 \@所有人
消息的权限，仅在文字子频道可用

嵌入文本格式：

##### 指令相关

目前仅在 markdown 支持。

格式：

原生 scheme 格式：

格式：

原生 scheme 格式：

##### 跳转子频道

仅频道可用，#子频道 解析为 #子频道
标签，点击可以跳转至子频道，仅支持当前频道内的子频道

##### 表情

仅频道可用，解析为系统表情，具体表情id参考 [Emoji
列表](https://bot.q.qq.com/wiki/develop/api/openapi/emoji/model.html#emoji-%E5%88%97%E8%A1%A8)，仅支持type=1的系统表情，type=2的emoji表情直接按字符串填写即可

#### ✅消息按钮

在 markdown 消息的基础上，支持消息最底部挂载按钮。

##### 

##### 发送方式

【申请使用】按钮模版，按钮模版暂时不支持使用变量填充。

【内邀开通】自定义按钮

##### 数据结构与协议

消息发送接口 keyboard 字段值是一个 json object，rows 数组表示每一行按钮

每个 button 是一个 json object，具体字段如下：

+---------------------+------+------+---------------------------------+
| **属性**            | **类 | **必 | **说明**                        |
|                     | 型** | 填** |                                 |
+---------------------+------+------+---------------------------------+
| id                  | st   | 否   | 按钮I                           |
|                     | ring |      | D：在一个keyboard消息内设置唯一 |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| render_data.label   | st   | 是   | 按钮上的文字                    |
|                     | ring |      |                                 |
+---------------------+------+------+---------------------------------+
| render              | st   | 是   | 点击后按钮的上文字              |
| _data.visited_label | ring |      |                                 |
+---------------------+------+------+---------------------------------+
| render_data.style   | int  | 是   | 按钮样式：0 灰色线框，1         |
|                     |      |      | 蓝色线框                        |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| action.type         | int  | 是   | 0 跳转按钮：http 或 小程序      |
|                     |      |      | 客户端识别 scheme,              |
|                     |      |      | data字段为链接                  |
|                     |      |      |                                 |
|                     |      |      | 1 回调按钮：回调后台接口, data  |
|                     |      |      | 传给后台                        |
|                     |      |      |                                 |
|                     |      |      | 2 指令按钮：自动在输入框插入    |
|                     |      |      | \@bot data                      |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| ac                  | int  | 是   | 0 指定用户可操作                |
| tion.permisson.type |      |      |                                 |
|                     |      |      | 1 仅管理者可操作                |
|                     |      |      |                                 |
|                     |      |      | 2 所有人可操作                  |
|                     |      |      |                                 |
|                     |      |      | 3                               |
|                     |      |      | 指定身份组可操作（仅频道可用）  |
+---------------------+------+------+---------------------------------+
| action.permiss      | a    | 否   | 有权限                          |
| on.specify_role_ids | rray |      | 的身份组id的列表（仅频道可用）  |
+---------------------+------+------+---------------------------------+
| action.permiss      | a    | 否   | 有权限的用户id的列表            |
| on.specify_user_ids | rray |      |                                 |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| data                | st   | 是   | 操作相关的数据                  |
|                     | ring |      |                                 |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| at_bo               | bool | 否   | 指令按                          |
| t_show_channel_list |      |      | 钮可用，弹出子频道选择器，默认  |
|                     |      |      | false（已弃用）                 |
+---------------------+------+------+---------------------------------+
| reply               | bool | 否   | 指令按钮可用，                  |
|                     |      |      | 指令是否带引用回复本消息，默认  |
|                     |      |      | false                           |
|                     |      |      |                                 |
|                     |      |      | 支持版本 8983                   |
+---------------------+------+------+---------------------------------+
| enter               | bool | 否   | 指令按                          |
|                     |      |      | 钮可用，点击按钮后直接自动发送  |
|                     |      |      | data，默认 false。              |
|                     |      |      |                                 |
|                     |      |      | 支持版本 8983                   |
+---------------------+------+------+---------------------------------+
| anchor              | bool | 否   | 指令按                          |
|                     |      |      | 钮可用，自动锚点到选图器，默认  |
|                     |      |      | false，设置 ture 后会忽略 enter |
|                     |      |      | 配置。                          |
|                     |      |      |                                 |
|                     |      |      | 支持版本 8983                   |
+---------------------+------+------+---------------------------------+
|                     |      |      |                                 |
+---------------------+------+------+---------------------------------+
| click_limit         | int  | 否   | 可操作点击的次数，默认不限      |
+---------------------+------+------+---------------------------------+
| unsupport_tips      | st   | 是   | 客户端不支持                    |
|                     | ring |      | 本action的时候，弹出的toast文案 |
+---------------------+------+------+---------------------------------+

示例

##### 事件

###### 点击回调按钮

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1\<\<26

  事件类型      INTERACTION_CREATE

  触发场景      用户点击了消息体的回调按钮

  权限要求      无特殊要求

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

+-----------------------+--------+------------------------------------+
| 属性                  | 类型   | 说明                               |
+-----------------------+--------+------------------------------------+
| id                    | string | 平台方事件                         |
|                       |        | ID，可以用于被动消息发送           |
+-----------------------+--------+------------------------------------+
| type                  | int    | 按钮事件固定是 11                  |
+-----------------------+--------+------------------------------------+
| chat_type             | int    | 消息内容                           |
+-----------------------+--------+------------------------------------+
| timestamp             | string | 消息生产时间                       |
+-----------------------+--------+------------------------------------+
| guild_id              | string | 频道的 openid                      |
+-----------------------+--------+------------------------------------+
| channel_id            | string | 文字子频道的 openid                |
+-----------------------+--------+------------------------------------+
| group_open_id         | string | 群聊的 openid                      |
+-----------------------+--------+------------------------------------+
| chat_type             | int    | 目前只有群和单聊有该字段，1        |
|                       |        | 群聊，2 单聊，                     |
|                       |        |                                    |
|                       |        | 后续加入 3 频道                    |
+-----------------------+--------+------------------------------------+
| data.                 | string | 操作按                             |
| resoloved.button_data |        | 钮的data字段值【在发送按钮时规划】 |
+-----------------------+--------+------------------------------------+
| dat                   | string | 操作                               |
| a.resoloved.button_id |        | 按钮的id字段值【在发送按钮时规划】 |
+-----------------------+--------+------------------------------------+
| d                     | string | 操作的用户 openid                  |
| ata.resoloved.user_id |        |                                    |
+-----------------------+--------+------------------------------------+
| data                  | string | 操作的消息id                       |
| .resoloved.message_id |        |                                    |
+-----------------------+--------+------------------------------------+
| version               | int    | 默认 1                             |
+-----------------------+--------+------------------------------------+
| application_id        | string | 机器人的 appid                     |
+-----------------------+--------+------------------------------------+
|                       |        |                                    |
+-----------------------+--------+------------------------------------+

-   **事件示例**

```{=html}
<!-- -->
```
-   **其他说明**

由于 websocket
推送事件是单向的，开发者收到事件之后，需要进行一次"回应"，告知QQ后台，事件已经收到，否则客户端会一直处于loading状态，直到超时。

回应的 openapi 接口如下：

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /interactions/{interaction_id}

  HTTP Method    PUT

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  ---------------- ---------- ---------- --------------------------------------------
  属性             **类型**   **必填**   **说明**

  interaction_id   string     是         上述事件中获得。
  ---------------- ---------- ---------- --------------------------------------------

-   **请求参数**

+-----------+------+----+--------------------------------------------+
| **属性**  | **类 | ** | **说明**                                   |
|           | 型** | 必 |                                            |
|           |      | 填 |                                            |
|           |      | ** |                                            |
+-----------+------+----+--------------------------------------------+
| code      | int  | 是 | 0 成功                                     |
|           |      |    |                                            |
|           |      |    | 1 操作失败                                 |
|           |      |    |                                            |
|           |      |    | 2 操作频繁                                 |
|           |      |    |                                            |
|           |      |    | 3 重复操作                                 |
|           |      |    |                                            |
|           |      |    | 4 没有权限                                 |
|           |      |    |                                            |
|           |      |    | 5 仅管理员操作                             |
+-----------+------+----+--------------------------------------------+

-   **返回参数**

  ------------- ---------- ------------------------------------------------
  **属性**      **类型**   **说明**

                           
  ------------- ---------- ------------------------------------------------

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

## 频道模块

### ✅频道管理

#### 获取机器人详情

-   **详细文档**

[获取用户详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/user/me.html)

#### 获取机器人加入频道列表

-   **详细文档**

[获取用户频道列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/user/guilds.html)

#### 获取频道详情

-   **详细文档**

[获取频道详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/get_guild.html)

#### 获取子频道列表

-   **详细文档**

[获取子频道列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/get_channels.html)

#### 获取子频道详情

-   **详细文档**

[获取子频道详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/get_channel.html)

#### 增删改子频道

-   **详细文档**

【私域接口】[创建子频道 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/post_channels.html)

【私域接口】[修改子频道 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/patch_channel.html)

【私域接口】[删除子频道 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/delete_channel.html)

#### 事件

##### 机器人添加到频道

-   **详细文档**

[频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild.html#guild-create)

##### 频道资料更新

-   **详细文档**

[频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild.html#guild-update)

##### 机器人被移出频道

-   **详细文档**

[频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild.html#guild-delete)

##### 解散频道

-   **详细文档**

[频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild.html#guild-delete)

##### 创建子频道

-   **详细文档**

[子频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/channel.html#channel-create)

##### 更新子频道

-   **详细文档**

[子频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/channel.html#channel-update)

##### 删除子频道

-   **详细文档**

[子频道事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/channel.html#channel-update)

### ✅频道成员

#### 获取子频道在线成员数

-   **详细文档**

[获取在线成员数 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel/get_online_nums.html)（音视频/直播子频道）

#### 

#### 获取频道成员列表

-   **详细文档**

【私域接口】[获取频道成员列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/member/get_members.html)

#### 

#### 获取频道身份组成员列表

-   **详细文档**

【私域接口】[获取频道身份组成员列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/member/get_role_members.html)

#### 

#### 获取频道成员详情

-   **详细文档**

[获取成员详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/member/get_member.html)

#### 

#### 删除频道成员

-   **详细文档**

【私域接口】[删除频道成员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/member/delete_member.html)

#### 事件

##### 用户加入频道

-   **详细文档**

[频道成员事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild_member.html#guild-member-add)

##### 用户更新在频道内的属性

-   **详细文档**

[频道成员事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild_member.html#guild-member-update)

##### 用户退出频道

-   **详细文档**

[频道成员事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/guild_member.html#guild-member-remove)

##### 用户进入子频道

-   **详细文档**

[音视频/直播子频道成员进出事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/audio_or_live_channel_member.html#audio-or-live-channel-member-enter)

##### 用户退出子频道

-   **详细文档**

[音视频/直播子频道成员进出事件 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/audio_or_live_channel_member.html#audio-or-live-channel-member-enter)

### ✅频道身份组与权限管理

#### 获取频道身份组列表

-   **详细文档**

[获取频道身份组列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/get_guild_roles.html)

#### 

#### 增删改频道身份组

-   **详细文档**

[创建频道身份组 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/post_guild_role.html)

[修改频道身份组 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/patch_guild_role.html)

[删除频道身份组 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/delete_guild_role.html)

#### 

#### 频道身份组添加成员

-   **详细文档**

[创建频道身份组成员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/put_guild_member_role.html)

#### 

#### 频道身份组删除成员

-   **详细文档**

[删除频道身份组成员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/delete_guild_member_role.html)

#### 

#### 获取子频道用户权限

-   **详细文档**

[获取子频道用户权限 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel_permissions/get_channel_permissions.html)

#### 

#### 修改子频道用户权限

-   **详细文档**

[修改子频道权限 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel_permissions/put_channel_permissions.html)

#### 获取子频道身份组权限

-   **详细文档**

[获取子频道身份组权限 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel_permissions/get_channel_roles_permissions.html)

#### 修改子频道身份组权限

-   **详细文档**

[修改子频道身份组权限 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/channel_permissions/put_channel_roles_permissions.html)

### ✅接口授权管理

#### 

#### 获取机器人在频道可用权限列表

-   **详细文档**

[获取频道可用权限列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/api_permissions/get_guild_api_permission.html)

#### 发送机器人在频道接口权限的授权链接

-   **详细文档**

[创建频道 API 接口权限授权链接 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/api_permissions/post_api_permission_demand.html)

### ✅发言管理

#### 获取频道消息频率的设置详情

-   **详细文档**

[获取频道消息频率设置 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/setting/message_setting.html)

#### 频道全员禁言

-   **详细文档**

[禁言全员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/patch_guild_mute.html)

#### 频道指定成员禁言

-   **详细文档**

[禁言指定成员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/patch_guild_member_mute.html)

#### 频道批量成员禁言

-   **详细文档**

[禁言批量成员 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/guild/patch_guild_mute_multi_member.html)

### ✅内容管理

#### 创建频道公告

-   **详细文档**

[创建频道公告 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/announces/post_guild_announces.html)

#### 删除频道公告

-   **详细文档**

[删除频道公告 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/announces/delete_guild_announces.html)

#### 添加精华消息

-   **详细文档**

[添加精华消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/pins/put_pins_message.html)

#### 删除精华消息

-   **详细文档**

[删除精华消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/pins/delete_pins_message.html)

#### 获取精华消息

-   **详细文档**

[获取精华消息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/pins/get_pins_message.html)

#### 获取日程列表

-   **详细文档**

[获取频道日程列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/schedule/get_schedules.html)

#### 获取日程详情

-   **详细文档**

[获取日程详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/schedule/get_schedule.html)

#### 创建修改删除日程

-   **详细文档**

[创建日程 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/schedule/post_schedule.html)

[修改日程 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/schedule/patch_schedule.html)

[删除日程 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/schedule/delete_schedule.html)

#### 

#### 音频控制

-   **详细文档**

[音频控制 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/audio/audio_control.html)

#### 机器人上下麦

-   **详细文档**

[机器人上麦 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/audio/put_mic.html)

[机器人下麦 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/audio/delete_mic.html)

#### 获取帖子列表

-   **详细文档**

【私域接口】[获取帖子列表 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/forum/get_threads_list.html)

#### 获取帖子详情

-   **详细文档**

【私域接口】[获取帖子详情 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/forum/get_thread.html)

#### 发表帖子

-   **详细文档**

【私域接口】[发表帖子 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/forum/put_thread.html)

#### 删除帖子

-   **详细文档**

【私域接口】[删除帖子 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/openapi/forum/delete_thread.html)

#### 事件

##### 帖子的增删改【私域】

-   **详细文档**

[论坛事件对象(ForumEvent) \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/forum.html)

##### 帖子的增删改【公域】

-   **详细文档**

[开放论坛事件对象(OpenForumEvent) \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/gateway/open_forum.html)

### ✅小程序相关

#### 

#### 开放数据域加密

[开放数据域加密 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/miniapp/opendata.html)

#### 获取频道和当前人信息

[获取频道和当前人信息 \|
QQ机器人文档](https://bot.q.qq.com/wiki/develop/api/miniapp/interface.html)

## 群组模块

### 群管理

#### 🚫获取群资料信息

暂不对外开放

#### 🚫获取机器人加入群列表

暂不对外开放

#### ✅事件(4)

##### ✅机器人加入群聊

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      GROUP_ADD_ROBOT

  触发场景      机器人被添加到群聊

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ------------------ -------- ----------------------------------------------
  属性               类型     说明

  timestamp          int      加入的时间戳

  group_openid       string   加入群的群openid

  op_member_openid   string   操作添加机器人进群的群成员openid
  ------------------ -------- ----------------------------------------------

-   **事件示例**

##### ✅机器人退出群聊

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      GROUP_DEL_ROBOT

  触发场景      机器人被移出群聊

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ------------------ -------- ----------------------------------------------
  属性               类型     说明

  timestamp          int      移除的时间戳

  group_openid       string   移除群的群openid

  op_member_openid   string   操作移除机器人退群的群成员openid
  ------------------ -------- ----------------------------------------------

-   **事件示例**

##### ✅群聊拒绝机器人主动消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      GROUP_MSG_REJECT

  触发场景      群管理员主动在机器人资料页操作关闭通知

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ------------------- --------- ------------------------------------------
  属性                类型      说明

  timestamp           int       操作的时间戳

  group_openid        string    操作群的群openid

  op_member_openid    string    操作群成员的openid
  ------------------- --------- ------------------------------------------

-   **事件示例**

##### ✅群聊接受机器人主动消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      GROUP_MSG_RECEIVE

  触发场景      群管理员主动在机器人资料页操作开启通知

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ------------------- --------- ------------------------------------------
  属性                类型      说明

  timestamp           int       操作的时间戳

  group_openid        string    操作群的群openid

  op_member_openid    string    操作群成员的openid
  ------------------- --------- ------------------------------------------

-   **事件示例**

### 群成员

#### 🚫获取用户群内身份

\[暂不开放\]

#### ⚠️**获取**群内成员列表

\[内邀开放\]

获取群成员 openid 列表

-   **请求**

  -------------- ---------------------------------------------------------
  基本           

  HTTP URL       /v2/groups/{group_openid}/members

  HTTP Method    POST

  接口频率限制   
  -------------- ---------------------------------------------------------

-   **路径参数**

  -------------- ---------- ---------- --------------------------------------------
  属性           **类型**   **必填**   **说明**

  group_openid   string     是         群聊的 openid
  -------------- ---------- ---------- --------------------------------------------

-   **请求参数**

  ------------- ---------- ---------- --------------------------------------------
  **属性**      **类型**   **必填**   **说明**

  limit         int        否         每页限制数量 1-500

  start_index   int        否         首页输入 0，后续填入返回参数的 next_index
  ------------- ---------- ---------- --------------------------------------------

-   **返回参数**

+------------+--------+------------------------------------------------+
| **属性**   | **     | **说明**                                       |
|            | 类型** |                                                |
+------------+--------+------------------------------------------------+
| members    | obje   | openid 列表                                    |
|            | ct\[\] |                                                |
|            |        | {member_openid:\'\',join_timestamp: 0}         |
+------------+--------+------------------------------------------------+
| next_index | int    | 下一页的拉取标记位                             |
+------------+--------+------------------------------------------------+

-   **错误码**

  ------------ ------------ ----------------------------------------------
  错误码       错误码取值   解决方案

  0            ok           
  ------------ ------------ ----------------------------------------------

#### 事件

##### 🚫用户加入群聊

暂不对外开放

##### 🚫用户退出群聊

暂不对外开放

### 三方平台

#### 🚫获取小程序链接

暂不对外开放

## 用户模块

### 用户管理

#### 🚫获取机器人的用户列表

暂不对外开放

#### ✅事件(4)

##### ✅用户添加机器人

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      FRIEND_ADD

  触发场景      用户添加机器人'好友'到消息列表

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ------------- ---------- ----------------------------------------------
  属性          类型       说明

  timestamp     int        添加时间戳

  openid        string     用户openid
  ------------- ---------- ----------------------------------------------

-   **事件示例**

##### ✅用户删除机器人

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      FRIEND_DEL

  触发场景      用户删除机器人'好友'

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ----------- ------------ ----------------------------------------------
  属性        类型         说明

  timestamp   int          删除时间戳

  openid      string       用户openid
  ----------- ------------ ----------------------------------------------

-   **事件示例**

##### ✅拒绝机器人主动消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      C2C_MSG_REJECT

  触发场景      用户在机器人资料卡手动关闭"主动消息"推送

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ----------- ------------ ----------------------------------------------
  属性        类型         说明

  timestamp   int          操作时间戳

  openid      string       用户 openid
  ----------- ------------ ----------------------------------------------

-   **事件示例**

##### ✅允许机器人主动消息

-   **基本概况**

  ------------- ---------------------------------------------------------
  基本          

  intents       1 \<\< 25

  事件类型      C2C_MSG_RECEIVE

  触发场景      用户在机器人资料卡手动开启"主动消息"推送开关

  权限要求      暂无

  推送方式      Websocket
  ------------- ---------------------------------------------------------

-   **事件字段**

  ----------- ------------ ----------------------------------------------
  属性        类型         说明

  timestamp   int          操作时间戳

  openid      string       用户 openid
  ----------- ------------ ----------------------------------------------

-   **事件示例**

### 三方平台

#### 🚫获取小程序链接

暂不对外开放

## 
